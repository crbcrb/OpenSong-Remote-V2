ons.ready(function(){var e=navigator.language||navigator.userLanguage;i18next.use(i18nextHttpBackend).use(i18nextBrowserLanguageDetector).init({lng:e,fallbackLng:"en",supportedLngs:["en","nl","es","pl"],load:"languageOnly",useLocalStorage:!1,debug:!1,backend:{loadPath:"./locales/{{lng}}/{{ns}}.json",crossDomain:!0},function(e,t){}}).then(function(e){document.getElementById("nav-admin").innerText=i18next.t("nav.admin"),document.getElementById("nav-remote").innerText=i18next.t("nav.remote"),document.getElementById("nav-searchP").innerText=i18next.t("nav.searchP"),document.getElementById("nav-searchL").innerText=i18next.t("nav.searchL"),document.getElementById("nav-alert").innerText=i18next.t("nav.alert"),document.getElementById("nav-setup").innerText=i18next.t("nav.setup"),document.getElementById("nav-info").innerText=i18next.t("nav.info"),document.getElementById("setup-titel").innerText=i18next.t("nav.setup"),document.getElementById("setup-head1").innerText=i18next.t("setup.head1"),document.getElementById("setup-head2").innerText=i18next.t("setup.head2"),document.getElementById("setup-head3").innerText=i18next.t("setup.head3"),document.getElementById("setup-theme").innerText=i18next.t("setup.theme"),document.getElementById("setup-theme1").innerText=i18next.t("setup.dark"),document.getElementById("setup-theme2").innerText=i18next.t("setup.light"),document.getElementById("setup-remote").innerText=i18next.t("setup.tonen"),document.getElementById("setup-remote1").innerText=i18next.t("setup.remote1"),document.getElementById("setup-remote2").innerText=i18next.t("setup.remote2"),document.getElementById("tekst-size").innerText=i18next.t("setup.textsize"),document.getElementById("tekst-small").innerText=i18next.t("setup.small"),document.getElementById("tekst-large").innerText=i18next.t("setup.large"),document.getElementById("setup-speed").innerHTML=i18next.t("setup.speed"),document.getElementById("speed1").innerText=i18next.t("setup.fast"),document.getElementById("speed2").innerText=i18next.t("setup.slow")})});var osrNames=[],osrHosts=[],osrPorts=[],osrWWs=[];localStorage.osrNames&&(osrNames=JSON.parse(localStorage.osrNames)),localStorage.osrHosts&&(osrHosts=JSON.parse(localStorage.osrHosts)),localStorage.osrPorts&&(osrPorts=JSON.parse(localStorage.osrPorts)),localStorage.osrWWs&&(osrWWs=JSON.parse(localStorage.osrWWs)),null===localStorage.osrTheme&&(localStorage.osrTheme="light"),"dark"==localStorage.osrTheme?document.querySelector("#thema").setAttribute("href","/css/dark-onsen-css-components.css"):document.querySelector("#thema").setAttribute("href","/css/onsen-css-components.css");const osrThemeAccent="rgb(30,136,229)",osrThemeDarkAccent="rgb(255,161,1)";var osrThemeColor="rgb(255,161,1)";null===localStorage.osrtekstSize?localStorage.osrtekstSize="6":localStorage.osrtekstSize>15&&(localStorage.osrtekstSize="6"),null===localStorage.osrRemote&&(localStorage.osrRemote="c"),null===localStorage.osrDisplay&&(localStorage.osrDisplay="2"),null===localStorage.osrLoadDelay&&(localStorage.osrLoadDelay="2");var currentHost=-1;osrNames.length>0&&(osrCurrentHostUrl="http://"+osrHosts[0]+":"+osrPorts[0]+"/",osrCurrentWsUrl="ws://"+osrHosts[0]+":"+osrPorts[0]+"/ws");var playList,sok,updateStatusBusy,lastUrl,delayReconnectTimer,currentMode="",lastMode="X",lastSectie=-1,lastSlide=-1,currentSectie=-1,currentSlide=-1,totalSlides=-1,loadServiceBusy=!1,lastPresentId="",ajaxBusy=0,loadDelayBase=100,loadDelay=loadDelayBase*localStorage.osrLoadDelay+Math.round(50*Math.random()),openSongVersie=2;function make_base_auth(e){return"Basic "+btoa(e)}window.osr={},window.osr.nextSlide=function(){osr.doeAktie("text","presentation/slide/next")},window.osr.previousSlide=function(){osr.doeAktie("text","presentation/slide/previous")},window.osr.delayReconnect=function(){clearTimeout(delayReconnectTimer),delayReconnectTimer=setTimeout(function(){osr.openHost(currentHost)},600*localStorage.osrLoadDelay)},window.osr.getStatus=function(e){lastUrl="presentation/status",fetch(osrCurrentHostUrl+lastUrl).then(function(e){if(!e.ok)throw Error(e.statusText);return e.text()}).then(function(e){osr.updateStatus(e)}).catch(function(e){})},window.osr.doeAktie=function(e,t){lastUrl=t,""!=osrWWs[currentHost]?fetch(osrCurrentHostUrl+t,{mode:"cors",method:"POST",headers:{Authorization:make_base_auth(osrWWs[currentHost]),"Content-Type":"text/plain"},body:""}).then(e=>{response.ok&&response.text().then(e=>{})}).catch(e=>{}):fetch(osrCurrentHostUrl+t,{mode:"cors",method:"POST",headers:{"Content-Type":"text/plain"},body:""}).then(e=>{response.ok&&response.text().then(e=>{})}).catch(e=>{})},window.osr.processPlaylist=function(e){try{playList=(new DOMParser).parseFromString(e,"text/xml")}catch(e){console.log("161- error parsing playlist ",e)}d="xxxxxxxxx";for(var t=1,n=playList.getElementsByTagName("slide"),s=0;s<n.length;s++){var r=n[s].getAttribute("identifier"),o=n[s].getAttribute("type");if(r&&"style"!==o)(p=n[s].getAttribute("name"))!==d&&"blank"!==o&&t++,n[s].setAttribute("sectie",parseInt(t,10)),d=p}t=n.length;var a=document.getElementById("myNavigator");if(pageId=a.topPage.id,"service-manager"==pageId&&t!=totalSlides){lastSlide=-1,lastSectie=-1,totalSlides=t;var i=1,l=document.getElementById("ulService");l.innerHTML="";var c,d="",u="",m=-1;for(s=0;s<n.length;s++)if(c=n[s].getAttribute("sectie")){var g;if(c!=m&&m>=0)(g=document.createElement("ons-list-item")).innerHTML=d+'<div class="expandable-content"><ons-list>'+u+"</ons-list></div>",g.setAttribute("expandable",!0),g.setAttribute("data-sectie",m),g.onclick=function(){osr.setController(this)},l.appendChild(g),u="";m=c,r=n[s].getAttribute("identifier");var p=n[s].getAttribute("name");if("scripture"==(o=n[s].getAttribute("type"))){var h="";try{if(n[s].getElementsByTagName("title").length>0)""!=(h=n[s].getElementsByTagName("title")[0].childNodes[0].nodeValue)&&(p=h)}catch(e){}}""!=p&&(d=p),"song"==(o=n[s].getAttribute("type"))?(u+='<ons-list-item onclick="osr.setSlide(this)" data-slide="'+r+'">placeholder '+r+" (sectie "+c+") soort: "+o+"</ons-list-item>",i++):u+='<ons-list-item onclick="osr.setSlide(this)" data-slide="'+r+'" data-song="'+i+'">placeholder '+r+" (sectie "+c+")</ons-list-item>"}(g=document.createElement("ons-list-item")).innerHTML=d+'<div class="expandable-content"><ons-list>'+u+"</ons-list></div>",g.setAttribute("expandable",!0),g.setAttribute("data-sectie",parseInt(m,10)),g.setAttribute("data-sectie",m),l.appendChild(g)}currentSectie=playList.querySelector('[identifier="'+parseInt(currentSlide,10)+'"]').getAttribute("sectie"),loadServiceBusy=!1,osr.showService()},window.osr.loadService=function(e){e&&e.preventDefault(),1!=loadServiceBusy&&(loadServiceBusy=!0,fetch(osrCurrentHostUrl+"presentation/slide/list").then(function(e){if(!e.ok)throw Error(e.statusText);return e.text()}).then(function(e){osr.processPlaylist(e)}).catch(function(e){console.warn("error fetching playlist ",e),ons.notification.alert("281- fetching playlist: ",e)}))},window.osr.showService=function(){switch((!playList||playList.length<1)&&(document.getElementById("ulService").innerHTML=""),statusId=document.getElementById("smStatus"),currentMode){case"N":statusId.innerHTML=i18next.t("state.normal");break;case"B":statusId.innerHTML=i18next.t("state.black");break;case"F":statusId.innerHTML=i18next.t("state.freeze");break;case"H":statusId.innerHTML=i18next.t("state.hide");break;case"L":statusId.innerHTML=i18next.t("state.logo");break;case"W":statusId.innerHTML=i18next.t("state.white");break;default:statusId.innerHTML="---"}var e,t;currentSectie!=lastSectie&&((e=document.querySelector('[data-sectie="'+parseInt(lastSectie,10)+'"]'))&&(e.expanded&&e.hideExpansion(),e.style.borderLeft=""),osr.loadController(currentSectie),(t=document.querySelector('[data-sectie="'+parseInt(currentSectie,10)+'"]'))&&!t.expanded&&t.showExpansion());if(t&&!t.expanded&&(t.style.borderLeft="8px solid "+osrThemeColor),(e=document.querySelector('[data-slide="'+parseInt(lastSlide,10)+'"]'))&&(e.style.borderLeft=""),(t=document.querySelector('[data-slide="'+parseInt(currentSlide,10)+'"]'))&&(t.style.borderLeft="8px solid "+osrThemeColor),t&&currentSectie>=0){var n=t.offsetTop,s=document.getElementById("ulService").parentNode.parentNode,r=s.scrollTop,o=(s.scrollHeight,s.parentNode.clientHeight-100);n+=document.querySelector('[data-sectie="'+parseInt(currentSectie,10)+'"]').offsetTop;var a=t.clientHeight;(n+a+a-r>o||n-a-a<r)&&(s.scrollTop=n-o/4)}},osr.processRemoteSlide=function(e){var t=localStorage.osrtekstSize;"dark"==localStorage.osrTheme?(document.getElementById("current-screen-titel").style.color="rgba(255,255,255,0.7)",document.getElementById("current-screen-tekst").style.color="rgba(255,255,255,1)"):(document.getElementById("current-screen-titel").style.color="rgba(0,0,0,0.7)",document.getElementById("current-screen-tekst").style.color="rgba(0,0,0,1)"),document.getElementById("current-screen-titel").style.fontSize=.85*t+"vmin",xSlide=(new DOMParser).parseFromString(e,"text/xml");xSlide.getElementsByTagName("response")[0].getAttribute("identifier"),xSlide.getElementsByTagName("response")[0].getAttribute("resource"),xSlide.getElementsByTagName("response")[0].getAttribute("action");var n=xSlide.getElementsByTagName("slide")[0].getAttribute("type"),s="";try{if(xSlide.getElementsByTagName("title").length>0)s=xSlide.getElementsByTagName("title")[0].childNodes[0].nodeValue}catch(e){}try{if(xSlide.getElementsByTagName("slides")[0].getElementsByTagName("body").length>0)xSlide.getElementsByTagName("slides")[0].getElementsByTagName("body")[0].lastChild.nodeValue}catch(e){}try{var r=xSlide.getElementsByTagName("presentation")[0].lastChild.nodeValue}catch(e){r=""}if(""!=s){if(""!=r.trim()){var o=r.split(" "),a=xSlide.getElementsByTagName("slides")[0].getElementsByTagName("slide")[0].getAttribute("PresentationIndex");for(r="",l=0;l<o.length;l++)l==a-1?(/^B/i.test(o[l])&&(r+="<strong>"+i18next.t("setup.bridge")+"</strong> "),/^C/i.test(o[l])&&(r+="<strong>"+i18next.t("setup.chorus")+"</strong> "),/^T/i.test(o[l])&&(r+="<strong>"+i18next.t("setup.tag")+"</strong> "),/^V(\S)*/i.test(o[l])&&(r+="<strong>"+o[l].substr(1,15)+"</strong> ")):/^V(\S)*/i.test(o[l])&&(r+=o[l].substr(1,15)+" ");s+=": "+r.trim().toLowerCase().replace(/ /g,", ")}}else s="";for(var i=xSlide.getElementsByTagName("slides")[0].getElementsByTagName("slide"),l=0;l<i.length;l++){try{var c=i[l].getElementsByTagName("body")[0].lastChild.nodeValue}catch(e){c=""}if("image"==n||"c"==localStorage.osrRemote){document.getElementById("current-screen-titel").innerHTML="";var d=window.innerWidth-48,u=window.innerHeight-64;c='<img src="'+osrCurrentHostUrl+"presentation/slide/"+currentSlide,c=u<9*d/16?c+"/image/height:"+u+'/Math.random()" height="'+u+'px">':c+"/image/width:"+d+'/Math.random()" width="'+d+'px">'}else document.getElementById("current-screen-titel").innerHTML=s}if("external"==n){var m=xSlide.getElementsByTagName("slide")[0].getAttribute("application"),g=xSlide.getElementsByTagName("slide")[0].getAttribute("filename");g=(g=g.replace(/^.*[\\\/]/,"")).replace(/%20/," ");var p="";try{p=xSlide.getElementsByTagName("description")[0].childNodes[0].nodeValue}catch(e){p=""}c=c+"("+m+") "+p+" - "+g}if("song"==n){if(a){var h=xSlide.getElementsByTagName("slides")[0].getElementsByTagName("slide")[0].getAttribute("id");verst=h.replace(/V/gi,""),verst=verst.replace(/C/gi,"refr"),verst=verst.replace(/T/gi,""),presentid=xSlide.getElementsByTagName("slides")[0].getElementsByTagName("slide")[0].getAttribute("PresentationIndex"),presentid!=lastPresentId&&(""!=verst&&(c="<sup>"+verst+". </sup>"+c),lastPresentId=presentid)}}else lastPresentId="";"scripture"==n&&(c=c.replace(/(\d\d?\d?[abc]?) /g,"<sup>$1&nbsp;</sup>")),c=(c=(c=(c=c.replace(/^\t/gm,"&nbsp;&nbsp;&nbsp;&nbsp;")).replace(/-\n/gm,"&shy;")).replace(/\n/g,"<br>")).replace(/[ \u00A0]<br>/g," "),"image"==n||"c"==localStorage.osrRemote?document.getElementById("current-screen-tekst").style.fontSize="1px":document.getElementById("current-screen-tekst").style.fontSize=t+"vmin",document.getElementById("current-screen-tekst").innerHTML=c},osr.showRemoteScreen=function(){"N"==currentMode&&currentSlide>=0?(lastUrl="presentation/slide/"+currentSlide,fetch(osrCurrentHostUrl+lastUrl).then(function(e){if(!e.ok)throw Error(e.statusText);return e.text()}).then(function(e){osr.processRemoteSlide(e)}).catch(function(e){console.log("fetching slide "+currentSlide+" "+e),ons.notification.toast("589- fetching slide "+currentSlide+" "+e,{timeout:3e3})})):"F"!=currentMode&&(document.getElementById("current-screen-titel").innerText="",document.getElementById("current-screen-tekst").innerHTML="")},osr.processControllerSlide=function(e){xSlide=(new DOMParser).parseFromString(e,"text/xml");var t=xSlide.getElementsByTagName("response")[0].getAttribute("identifier"),n=(xSlide.getElementsByTagName("response")[0].getAttribute("resource"),xSlide.getElementsByTagName("response")[0].getAttribute("action"),xSlide.getElementsByTagName("slide")[0].getAttribute("type"));try{if(xSlide.getElementsByTagName("title").length>0)xSlide.getElementsByTagName("title")[0].childNodes[0].nodeValue}catch(e){}var s="";try{if(xSlide.getElementsByTagName("slides")[0].getElementsByTagName("body").length>0)s=xSlide.getElementsByTagName("slides")[0].getElementsByTagName("body")[0].lastChild.nodeValue}catch(e){}if("song"==n)var r=xSlide.getElementsByTagName("slide")[1].getAttribute("id");var o=document.querySelector('[data-slide="'+parseInt(t,10)+'"]').firstChild;s=(s=(s=(s=(s=s.replace(/^\t/gm,"&nbsp;&nbsp;&nbsp;&nbsp;")).replace(/-\n/gm,"&shy;")).replace(/_\n/g," ")).replace(/\n/g,"<br>")).replace(/[ \u00A0]<br>/g," ");var a=playList.querySelector('slide[identifier="'+t+'"]');switch(a&&a.setAttribute("loaded",!0),n){case"custom":o.innerHTML=s;break;case"image":var i="";try{i=xSlide.getElementsByTagName("description")[0].childNodes[0].nodeValue}catch(e){i=""}tekst='<img src="'+osrCurrentHostUrl+"presentation/slide/"+t+'/image/width:160" style="float:left;padding-right:20px;">'+i,o.innerHTML=tekst;break;case"external":var l=xSlide.getElementsByTagName("slide")[0].getAttribute("application"),c=xSlide.getElementsByTagName("slide")[0].getAttribute("filename");c=(c=c.replace(/^.*[\\\/]/,"")).replace(/%20/," ");i="";try{i=xSlide.getElementsByTagName("description")[0].childNodes[0].nodeValue}catch(e){i=""}o.innerHTML=s+"("+l+") "+i+" - "+c;break;case"scripture":o.innerHTML=s;break;case"song":verst=r.replace(/V/i,""),verst=verst.replace(/B/gi,i18next.t("setup.bridge")),verst=verst.replace(/C/gi,i18next.t("setup.chorus")),verst=verst.replace(/T/gi,i18next.t("setup.tag")),s=verst+"<br>"+s,o.innerHTML=s;break;default:o.innerHTML=tekst}--ajaxBusy<1&&(document.getElementById("bezig").removeAttribute("indeterminate",!1),osr.showService())},osr.delayControllerSlide=function(e){setTimeout(function(){osr.getControllerSlide(e)},ajaxBusy*loadDelay)},osr.getControllerSlide=function(e){"X"!=currentMode?(lastUrl="presentation/slide/"+e,fetch(osrCurrentHostUrl+"presentation/slide/"+e).then(function(e){if(!e.ok)throw Error(e.statusText);return e.text()}).then(function(e){osr.processControllerSlide(e)}).catch(function(t){ajaxBusy--,console.log("fetching slide "+e+" "+t)})):ajaxBusy--},osr.loadController=function(e){if(playList)for(var t=playList.getElementsByTagName("slide"),n=0;n<t.length;n++){var s=t[n].getAttribute("identifier"),r=t[n].getAttribute("sectie"),o=t[n].getAttribute("type"),a=t[n].getAttribute("loaded");if(s&&r==e&&!a)if("blank"==o)document.querySelector('[data-slide="'+parseInt(s,10)+'"]').innerHTML="-----";else ajaxBusy++,document.getElementById("bezig").setAttribute("indeterminate",!0),osr.delayControllerSlide(s)}},window.osr.setController=function(e){var t=e.getAttribute("data-sectie");e.expanded?(e.style.borderLeft="",osr.loadController(t)):t==currentSectie&&(e.style.borderLeft="8px solid "+osrThemeColor)},window.osr.setSlide=function(e){var t=e.getAttribute("data-slide");osr.doeAktie("text","presentation/slide/"+t)},window.osr.open=function(){document.getElementById("menu").open()},window.osr.loadPage=function(e){myNavigator=document.getElementById("myNavigator");var t=document.getElementById("menu");myNavigator.bringPageTop(e).then(t.close.bind(t))},window.osr.editHost=function(e){e&&(currentHost=-1),document.getElementById("hostMenu").hide();var t=document.getElementById("EditHost");t?t.show():ons.createElement("edithost.html",{append:!0}).then(function(e){e.show()})},window.osr.cancelEditHost=function(e){document.getElementById("EditHost").hide(),currentHost=-1},window.osr.deleteHost=function(e){osrNames.splice(currentHost,1),osrHosts.splice(currentHost,1),osrPorts.splice(currentHost,1),osrWWs.splice(currentHost,1),document.getElementById("hostMenu").hide(),localStorage.osrNames=JSON.stringify(osrNames),localStorage.osrHosts=JSON.stringify(osrHosts),localStorage.osrPorts=JSON.stringify(osrPorts),localStorage.osrWWs=JSON.stringify(osrWWs),currentHost=-1,osr.refreshHostList()},window.osr.refreshHostList=function(){var e=document.getElementById("OsHosts");if(e.innerHTML="",osrNames.length>0)for(let n=0;n<osrNames.length;n++){var t=document.createElement("ons-list-item");t.innerHTML='<div class="right" onclick="osr.hostMenuClick(this);">&nbsp;<ons-icon icon="md-more-vert" class="list-item__icon"></ons-icon>&nbsp;</div>'+osrNames[n],t.setAttribute("data-hostId",n),t.onclick=function(){osr.hostClick(this)},e.appendChild(t)}document.getElementById("screenSize").value=localStorage.osrtekstSize,document.getElementById("loadDelay").value=localStorage.osrLoadDelay},window.osr.editHostSave=function(e){currentHost>=0?(osrNames[currentHost]=document.getElementById("ehName").value,osrHosts[currentHost]=document.getElementById("ehIP").value,osrPorts[currentHost]=document.getElementById("ehPort").value,osrWWs[currentHost]=document.getElementById("ehPassword").value):osrNames.includes(document.getElementById("ehName").value)?ons.notification.alert(i18next.t("setup.host1")):(osrNames.push(document.getElementById("ehName").value),osrHosts.push(document.getElementById("ehIP").value),osrPorts.push(document.getElementById("ehPort").value),osrWWs.push(document.getElementById("ehPassword").value)),localStorage.osrNames=JSON.stringify(osrNames),localStorage.osrHosts=JSON.stringify(osrHosts),localStorage.osrPorts=JSON.stringify(osrPorts),localStorage.osrWWs=JSON.stringify(osrWWs),osr.refreshHostList(),document.getElementById("EditHost").hide(),currentHost=-1},window.osr.hostClick=function(e){currentHost=e.getAttribute("data-hostid"),e.style.borderLeft="8px solid "+osrThemeColor;osrNames[currentHost];osr.openHost(currentHost)},window.osr.hostMenuClick=function(e){event.stopPropagation(),currentHost=e.parentNode.getAttribute("data-hostid"),document.getElementById("hostMenu").show(e)},window.osr.warnMenu=function(){var e=document.getElementById("popupWarning");e?e.show():ons.createElement("popupWarning.html",{append:!0}).then(function(e){e.show()}),document.getElementById("menu").close()},window.osr.setWarn=function(e){if("setWarn"==e.id){var t=document.getElementById("warnMessage").value;osr.doeAktie("text","presentation/screen/alert/message:"+encodeURI(t))}else osr.doeAktie("text","presentation/screen/alert/");document.getElementById("popupWarning").hide()},window.osr.updateStatus=function(e){if("OK"!=e&&1!=updateStatusBusy&&e.includes(">")){lastSlide=currentSlide,lastSectie=currentSectie,updateStatusBusy=!0,pageId=myNavigator.topPage.id;try{xmlStatus=(new DOMParser).parseFromString(e,"text/xml")}catch(e){console.log("error parsing status ",e)}var t=0;xmlStatus.getElementsByTagName("presentation")[0].hasAttribute("running")&&(t=xmlStatus.getElementsByTagName("presentation")[0].getAttribute("running"));xmlStatus.getElementsByTagName("response")[0].getAttribute("resource"),xmlStatus.getElementsByTagName("response")[0].getAttribute("action");if(xmlStatus.getElementsByTagName("response")[0].hasAttribute("reason")){openSongVersie=3;var n=xmlStatus.getElementsByTagName("response")[0].getAttribute("reason")}switch(n||(n="change"),n){case"change":case"subscribe":case"starting":case"clear":break;case"closed":case"insert_song":case"insert_scripture":playList="",currentSlide=-1,currentSectie=-1,lastSlide=-1,lastSectie=-1}if("1"==t&&"change"==n){if(currentSlide=xmlStatus.getElementsByTagName("slide")[0].getAttribute("itemnumber"),currentSectie=playList?playList.querySelector('[identifier="'+parseInt(currentSlide,10)+'"]').getAttribute("sectie"):-1,playList){var s=xmlStatus.getElementsByTagName("name")[0];if(s&&s.hasChildNodes())(s=s.childNodes[0].nodeValue)!=playList.querySelector('[identifier="'+parseInt(currentSlide,10)+'"]').getAttribute("name")&&(playList="",currentSlide=-1,currentSectie=-1,lastSlide=-1,lastSectie=-1)}switch(currentMode=xmlStatus.getElementsByTagName("screen")[0].getAttribute("mode"),pageId){case"service-manager":-1==lastSlide||-1==lastSectie?(console.groupEnd(),setTimeout(function(){osr.loadService()},loadDelay)):osr.showService();break;case"remote-screen":console.groupEnd(),osr.showRemoteScreen()}}else switch("X"==lastMode||loadServiceBusy||ons.notification.toast(i18next.t("setup.net6"),{timeout:5e3}),currentMode="X",playList="",lastStatus="",lastMode="",lastSectie=-1,lastSlide=-1,currentSectie=-1,currentSlide=-1,totalSlides=-1,loadServiceBusy=!1,updateStatusBusy=!1,pageId){case"service-manager":console.groupEnd(),osr.showService();break;case"remote-screen":console.groupEnd(),osr.showRemoteScreen()}updateStatusBusy=!1,console.groupEnd()}},window.osr.openHost=function(e){playList&&playList.length>1&&(currentMode="X",playList="",lastStatus="",lastMode="",lastSectie=-1,lastSlide=-1,currentSectie=-1,currentSlide=-1,totalSlides=-1,loadServiceBusy=!1,updateStatusBusy=!1),ajaxBusy=0;var t=document.getElementById("myNavigator");void 0!==sok&&1==sok.readyState&&sok.close(),osrCurrentHostUrl="http://"+osrHosts[currentHost]+":"+osrPorts[currentHost]+"/",osrCurrentWsUrl="ws://"+osrHosts[currentHost]+":"+osrPorts[currentHost]+"/ws","WebSocket"in window?((sok=new WebSocket(osrCurrentWsUrl)).onopen=function(){sok.send("/ws/subscribe/presentation"),ons.notification.toast(i18next.t("setup.net1")+osrNames[e],{timeout:1e3}),t.bringPageTop("service-manager.html")},sok.onmessage=function(e){osr.updateStatus(e.data)},sok.onerror=function(){osr.delayReconnect(),ons.notification.alert(i18next.t("setup.net3")),currentHost=-1,t.bringPageTop("setup.html")},sok.onclose=function(){currentHost=-1,ons.notification.toast(i18next.t("setup.net4"),{timeout:1e4})}):(currentHost=-1,ons.notification.alert(i18next.t("setup.net5")))},window.osr.themaClick=function(e){var t=document.forms.fThema.thema.value;localStorage.osrTheme=t,osr.thema(t)},window.osr.thema=function(e){"dark"==e?(document.querySelector("#thema").setAttribute("href","./css/dark-onsen-css-components.css"),document.getElementById("lblThema1").checked=!0,osrThemeColor="rgb(255,161,1)"):(document.querySelector("#thema").setAttribute("href","./css/onsen-css-components.css"),document.getElementById("lblThema2").checked=!0,osrThemeColor=osrThemeAccent)},window.osr.screenSoortClick=function(e){var t=document.forms.fScreenSoort.screensoort.value;localStorage.osrRemote=t},window.osr.statusClick=function(e){ons.openActionSheet({cancelable:!0,buttons:[i18next.t("state.normal"),i18next.t("state.black"),i18next.t("state.white"),i18next.t("state.hide"),i18next.t("state.logo"),i18next.t("state.freeze")]}).then(function(e){switch(console.log("selected status: ",e),e){case 0:osr.doeAktie("text","presentation/screen/normal","");break;case 1:osr.doeAktie("text","presentation/screen/toggle_black","");break;case 2:osr.doeAktie("text","presentation/screen/toggle_white","");break;case 3:osr.doeAktie("text","presentation/screen/toggle_hide","");break;case 4:osr.doeAktie("text","presentation/screen/toggle_logo","");break;case 5:osr.doeAktie("text","presentation/screen/toggle_freeze","")}})},osr.processSetList=function(e){var t=document.getElementById("search-sets").firstChild;t.length=0;var n=document.createElement("option");n.value="",n.innerText=i18next.t("setup.choose"),t.appendChild(n);for(var s=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("set"),r=0;r<s.length;r++){var o=s[r].firstChild.nodeValue;(n=document.createElement("option")).value=o,n.innerText=o,t.appendChild(n)}document.getElementById("sets-status").innerText=i18next.t("search.choose")},osr.presentShow=function(e){var t=e.target.value,n=1;document.querySelector('input[name="mode"]').checked&&(n=2),"X"!=currentMode?ons.notification.confirm({title:i18next.t("search.letop"),message:i18next.t("search.stopwarn"),buttonLabels:[i18next.t("nav.cancel"),i18next.t("nav.ok")],callback:function(e){e>0&&(osr.doeAktie("text","presentation/close"),setTimeout(function(){osr.doeAktie("text","set/present/"+encodeURI(t)+"/display:"+n)},3*loadDelay),setTimeout(function(){myNavigator.bringPageTop("service-manager.html")},6*loadDelay))}}):(osr.doeAktie("text","set/present/"+encodeURI(t)+"/display:"+n),setTimeout(function(){myNavigator.bringPageTop("service-manager.html")},3*loadDelay))},osr.presentStop=function(){"X"!=currentMode?osr.doeAktie("text","presentation/close"):ons.notification.alert("er loopt geen presentatie ")},osr.showSet=function(){document.getElementById("search-sets").firstChild.length<=1&&(document.getElementById("sets-status").innerText="Even geduld, lijst wordt opgehaald...",lastUrl="set/list/",fetch(osrCurrentHostUrl+lastUrl).then(function(e){if(!e.ok)throw Error(e.statusText);return e.text()}).then(function(e){osr.processSetList(e)}).catch(function(e){ons.notification.alert("1238- fetch set list error "+e)}))},osr.addSong=function(){var e=document.getElementById("search-folders").firstChild.value,t=document.getElementById("search-songs").firstChild.value;if(""!=e&&""!=t){var n=document.getElementById("song-verses").value;n=openSongVersie<3?n.trim():n.trim().replace(/ /gi,",");var s=document.getElementById("after-song").firstChild.value;lastUrl="presentation/slide/song/folder:"+encodeURI(e)+"/song:"+encodeURI(t)+"/after:"+s+"/order:"+encodeURI(n),osr.doeAktie("text",lastUrl),openSongVersie<3&&(currentSlide=-1,currentSectie=-1,totalSlides=-1,playList=""),ons.notification.toast(i18next.t("song.insert2")+" "+t+": "+n,{timeout:3e3})}},osr.processSong=function(e){var t=(new DOMParser).parseFromString(e,"text/xml"),n=t.getElementsByTagName("title")[0].childNodes[0].nodeValue;document.getElementById("song-titel").innerHTML=n;var s=t.getElementsByTagName("presentation")[0].childNodes[0].nodeValue;document.getElementById("song-verses").value=s;var r=t.getElementsByTagName("lyrics")[0].childNodes[0].nodeValue;document.getElementById("song-lyrics").innerText=r,document.getElementById("search-status").innerHTML=""},osr.selectSong=function(e){var t=document.getElementById("search-songs").firstChild.value;if(t&&"blank"!=t){var n=document.getElementById("search-folders").firstChild.value;document.getElementById("search-status").innerHTML="Even geduld, lied wordt opgehaald...",lastUrl="song/detail/"+encodeURI(t)+"/folder:"+encodeURI(n),fetch(osrCurrentHostUrl+lastUrl).then(function(e){if(!e.ok)throw Error(e.statusText);return e.text()}).then(function(e){osr.processSong(e)}).catch(function(e){console.log(e),ons.notification.alert("1254- fetch song error "+e)})}},osr.filterSong=function(e){e=-1;for(var t=document.getElementById("search-filter").value,n=document.getElementById("search-songs").firstChild,s=1;s<n.length;s++){n.options[s].text.toLowerCase().includes(t.toLowerCase())||""===t.trim()?(n.options[s].style.display="list-item",e<0&&(e=s)):n.options[s].style.display="none"}n.selectedIndex=0},osr.processSongFolder=function(e){var t=document.getElementById("search-songs").firstChild;t.length=0;var n=document.getElementById("search-folders").firstChild.value;(o=document.createElement("option")).value="blank",o.innerText=i18next.t("song.choose2")+n,t.appendChild(o);for(var s=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("song"),r=0;r<s.length;r++){var o,a=s[r].getAttribute("name"),i=a.split(".").pop();if(""!=a&&"jpg"!=i)(o=document.createElement("option")).value=a,o.onclick=function(){osr.selectSong(this)},o.innerText=a,t.appendChild(o)}document.getElementById("search-filter").value="",document.getElementById("search-status").innerHTML=""},osr.selectFolder=function(e){var t=e.target.value;"blank"!=t&&(document.getElementById("search-status").innerHTML="Even geduld, lijst wordt opgehaald...",document.getElementById("song-titel").innerHTML="&nbsp;",document.getElementById("song-verses").value="",lastUrl="song/list/folder:"+encodeURI(t),fetch(osrCurrentHostUrl+lastUrl).then(function(e){if(!e.ok)throw Error(e.statusText);return e.text()}).then(function(e){osr.processSongFolder(e)}).catch(function(e){console.log(e),ons.notification.alert("1323- fetch song folder error "+e)}))},osr.processSongDir=function(e){var t=document.getElementById("search-folders").firstChild;t.length=0,(r=document.createElement("option")).value="blank",r.innerText=i18next.t("song.choose1"),t.appendChild(r);for(var n=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("folder"),s=0;s<n.length;s++){var r,o=n[s].getAttribute("name");if(""!=o&&"("!=o.substr(0,1))(r=document.createElement("option")).value=o,r.innerText=o,t.appendChild(r)}document.getElementById("search-status").innerHTML=""},osr.showSongDirs=function(){var e=document.getElementById("after-song").firstChild;e.length=0;for(var t=playList.getElementsByTagName("slide"),n="",s=0;s<t.length;s++){var r=t[s].getAttribute("identifier"),o=t[s].getAttribute("type");if(r&&"style"!==o){var a=t[s].getAttribute("name");if(a!==n&&""!==n){var i=document.createElement("option");i.value=r,i.innerText=n,e.appendChild(i)}n=a}}document.getElementById("search-folders").length<=1&&(document.getElementById("search-status").innerHTML="Even geduld, lijst wordt opgehaald...",lastUrl="song/folders/",fetch(osrCurrentHostUrl+lastUrl).then(function(e){if(!e.ok)throw Error(e.statusText);return e.text()}).then(function(e){osr.processSongDir(e)}).catch(function(e){ons.notification.alert("1250- fetch song folders error "+e)}))},osr.rangeChanged=function(e){switch(e.id){case"loadDelay":loadDelay=loadDelayBase*e.value+Math.round(50*Math.random()),localStorage.osrLoadDelay=e.value;break;case"screenSize":console.log("screenSize is nu ",e.value),localStorage.osrtekstSize=e.value}},document.addEventListener("show",function(e){var t=e.target;if(""!=t.id)switch(content=document.getElementById("myNavigator"),t.id){case"service-manager":var n;currentSectie>=0&&osr.loadController(currentSectie),(n=document.querySelector('[data-sectie="'+parseInt(currentSectie,10)+'"]'))&&!n.expanded&&n.showExpansion(),(n=document.querySelector('[data-slide="'+parseInt(currentSlide,10)+'"]'))&&(n.scrollIntoView({behavior:"smooth",block:"center"}),n.style.borderLeft="8px solid "+osrThemeColor),ons.platform.isAndroid()&&document.documentElement.requestFullscreen();break;case"remote-screen":osr.showRemoteScreen(),ons.platform.isAndroid()&&document.documentElement.requestFullscreen();break;case"presentatie":osr.showSet();break;case"search":osr.showSongDirs();break;case"setup":var s=document.getElementById("OsHosts").children;if(s.length>0)for(var r=0;r<s.length;r++)s[r].style.borderLeft=r==currentHost?"8px solid "+osrThemeColor:"";break;default:ons.platform.isAndroid()&&document.exitFullscreen()}},!1),document.addEventListener("hide",function(e){var t=e.target;if(""!=t.id)switch(content=document.getElementById("myNavigator"),t.id){case"service-manager":var n;(n=document.querySelector('[data-sectie="'+parseInt(currentSectie,10)+'"]'))&&(n.style.borderLeft="",n.expanded&&n.hideExpansion()),(n=document.querySelector('[data-slide="'+parseInt(currentSlide,10)+'"]'))&&(n.style.borderLeft="")}},!1),document.addEventListener("init",function(e){var t=e.target;if(""!=t.id)switch(content=document.getElementById("myNavigator"),t.id){case"service-manager":document.getElementById("service-titel").innerText=i18next.t("nav.admin"),document.getElementById("service-previous").innerText=i18next.t("state.left"),document.getElementById("service-next").innerText=i18next.t("state.right"),osr.getStatus();break;case"presentatie":document.getElementById("present-searchP").innerText=i18next.t("nav.searchP"),document.getElementById("present-head1").innerText=i18next.t("search.sets"),document.getElementById("sets-status").innerText=i18next.t("search.wait"),document.getElementById("sets-screen1").innerText=i18next.t("setup.mode1"),document.getElementById("sets-screen2").innerText=i18next.t("setup.mode2"),document.getElementById("set-show").innerText=i18next.t("search.stopshow");break;case"search":document.getElementById("search-head1").innerText=i18next.t("nav.searchL"),document.getElementById("search-head2").innerText=i18next.t("song.head2"),document.getElementById("search-after").innerText=i18next.t("song.after"),document.getElementById("song-verses-label").innerText=i18next.t("song.setverse"),document.getElementById("song-show").innerText=i18next.t("song.insert1");break;case"setup":switch(osr.refreshHostList(),osr.thema(localStorage.osrTheme),localStorage.osrRemote){case"c":document.getElementById("lblRemote1").checked=!0;break;default:document.getElementById("lblRemote2").checked=!0}break;case"info":document.getElementById("info1").innerText=i18next.t("info.line1"),document.getElementById("info2").innerText=i18next.t("info.line2"),document.getElementById("info3").innerText=i18next.t("info.line3"),document.getElementById("info4").innerText=i18next.t("info.line4"),document.getElementById("info5").innerText=i18next.t("info.line5"),document.getElementById("info6").innerHTML=i18next.t("info.line6"),document.getElementById("info7").innerText=i18next.t("info.line7"),document.getElementById("info8").innerText=i18next.t("info.line8")}},!1),document.addEventListener("preshow",function(e){switch(e.target.id){case"setup":break;case"EditHost":document.getElementById("ehTitel").innerText=i18next.t("setup.hosttitel"),document.getElementById("ehName").setAttribute("placeholder",i18next.t("nav.info")),document.getElementById("ehIP").setAttribute("placeholder",i18next.t("setup.host")),document.getElementById("ehPort").setAttribute("placeholder",i18next.t("setup.port")),document.getElementById("ehPassword").setAttribute("placeholder",i18next.t("setup.ww")),document.getElementById("ehCancel").innerText=i18next.t("nav.cancel"),document.getElementById("ehSave").innerText=i18next.t("nav.save");break;case"popupWarning":document.getElementById("alert-head1").innerText=i18next.t("alert.alert"),document.getElementById("clearWarn").innerText=i18next.t("alert.hide"),document.getElementById("setWarn").innerText=i18next.t("alert.show")}},!1),document.addEventListener("postshow",function(e){switch(e.target.id){case"service-manager":osr.showService();break;case"EditHost":currentHost>=0?(document.getElementById("ehName").value=osrNames[currentHost],document.getElementById("ehIP").value=osrHosts[currentHost],document.getElementById("ehPort").value=osrPorts[currentHost],document.getElementById("ehPassword").value=osrWWs[currentHost]):(document.getElementById("ehName").value="",document.getElementById("ehIP").value="",document.getElementById("ehPort").value="8082",document.getElementById("ehPassword").value="")}},!1),document.addEventListener("keyup",function(e){switch(e.keyCode){case 37:osr.doeAktie("text","presentation/section/previous");break;case 33:case 38:osr.doeAktie("text","presentation/slide/previous");break;case 39:osr.doeAktie("text","presentation/section/next");break;case 32:case 34:case 40:osr.doeAktie("text","presentation/slide/next")}},!0);